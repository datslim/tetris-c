/**
 * @file game_scoring.h
 * @brief Заголовочный файл системы подсчета очков и уровней
 * @author lucoscly
 *
 * Этот модуль реализует систему подсчета очков, управление рекордами и
 * расчет скорости игры в зависимости от уровня. Включает константы для
 * начисления бонусов за очистку линий.
 */

#ifndef GAME_SCORING_H
#define GAME_SCORING_H

#include <stdio.h>

#include "../../common/defines.h"
#include "../game.h"

/**
 * @defgroup scoring_rules Правила подсчета очков
 * @{
 */
#define ONE_LINE_BOUNTY 100 /**< Базовый бонус за одну очищенную линию */
#define TWO_LINES_BOUNTY 300 /**< Бонус за одновременную очистку двух линий */
#define THREE_LINES_BOUNTY 700 /**< Бонус за тройную комбинацию */
#define FOUR_LINES_BOUNTY \
  1500 /**< Максимальный бонус за тетрис (четыре линии) */
/** @} */  // end of scoring_rules

/**
 * @brief Расчет очков за очищенные линии
 *
 * Учитывает количество одновременно очищенных линий и текущий уровень.
 * Обновляет общий счет и проверяет достижение нового рекорда.
 *
 * @param state Указатель на текущее состояние игры
 * @param lines_cleared Количество очищенных линий
 */
void calculate_score(GameState *state, int lines_cleared);

/**
 * @brief Загрузка рекорда из файла
 *
 * Читает сохраненный рекорд из файла и устанавливает его в структуре игры.
 * Если файл не существует, устанавливает начальное значение.
 *
 * @param game_info Указатель на структуру с информацией о игре
 */
void load_high_score(GameInfo_t *game_info);

/**
 * @brief Расчет текущего уровня и скорости игры
 *
 * Определяет уровень на основе счета и вычисляет базовую скорость падения
 * фигур с учетом текущего уровня сложности.
 *
 * @param state Указатель на состояние игры для обновления параметров
 */
void calculate_level_and_speed(GameState *state);

/**
 * @brief Сохранение нового рекорда
 *
 * Записывает новый рекорд в файл, если текущий счет превышает
 * предыдущее максимальное значение.
 *
 * @param game_info Указатель на структуру с информацией о игре
 */
void save_high_score(GameInfo_t *game_info);

#endif